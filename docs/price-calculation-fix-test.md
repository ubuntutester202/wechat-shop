# 价格计算修复测试说明

## 问题描述
在 ProductSpecModal 中选择规格时会动态计算价格（包含 priceModifier），但在购物车页面显示的仍然是基础价格，没有应用规格调整。

## 修复内容
1. **修改 ProductSpecModal 接口**：`onConfirm` 回调增加 `finalPrice` 参数
2. **修改 ProductDetailPage**：`handleSpecConfirm` 接收最终价格并传递给购物车
3. **购物车存储**：使用计算后的最终价格而非基础价格

## 测试步骤

### 1. 测试商品1 - 时尚休闲连帽卫衣
**基础价格**：¥17.00

**规格调整**：
- XL尺寸：+¥2.00（最终价格：¥19.00）
- XXL尺寸：+¥5.00（最终价格：¥22.00）
- 其他规格：无调整

**测试流程**：
1. 访问 `http://localhost:5173/product/1`
2. 点击"加入购物车"
3. 选择颜色：黑色，尺寸：XL
4. 确认弹框中显示价格为 ¥19.00
5. 点击"加入购物车"
6. 访问购物车页面 `/cart`
7. **验证**：购物车中显示价格为 ¥19.00（不是 ¥17.00）

### 2. 测试商品2 - 经典款牛仔外套
**基础价格**：¥17.00

**规格调整**：
- 深蓝色：+¥3.00
- 复古蓝：+¥8.00
- XL尺寸：+¥2.00
- 宽松版：+¥4.00

**测试流程**：
1. 访问 `http://localhost:5173/product/2`
2. 点击"加入购物车"
3. 选择规格：复古蓝 + XL + 宽松版
4. 确认弹框中显示价格：¥17.00 + ¥8.00 + ¥2.00 + ¥4.00 = ¥31.00
5. 点击"加入购物车"
6. 访问购物车页面
7. **验证**：购物车中显示价格为 ¥31.00

### 3. 测试购物车总价计算
**测试场景**：同时添加多个不同规格的商品

1. 添加商品1（XL尺寸）：¥19.00 × 2件 = ¥38.00
2. 添加商品2（复古蓝+XL+宽松版）：¥31.00 × 1件 = ¥31.00
3. **验证总价**：¥38.00 + ¥31.00 = ¥69.00

### 4. 测试数量修改
1. 在购物车页面修改商品数量
2. **验证**：总价按照最终价格重新计算
3. 例如：将商品1数量改为3件，总价应为：¥19.00 × 3 + ¥31.00 = ¥88.00

## 验证检查点

### ✅ 正确行为
- [ ] ProductSpecModal 弹框中价格实时更新
- [ ] 购物车商品价格显示为最终价格（包含规格调整）
- [ ] 购物车总价计算正确
- [ ] 数量修改后总价重新计算正确

### ❌ 错误行为（修复前）
- [ ] 购物车中显示基础价格（¥17.00）
- [ ] 规格调整价格丢失
- [ ] 总价计算不准确

## 技术实现细节

### 修改的文件
1. `src/components/ui/ProductSpecModal.tsx`
   - 修改接口定义，增加 `finalPrice` 参数
   - 修改回调调用，传递计算后的价格

2. `src/pages/product/ProductDetailPage.tsx`
   - 修改 `handleSpecConfirm` 函数签名
   - 使用 `finalPrice` 而不是 `product.price`

### 价格计算公式
```typescript
let finalPrice = product.price; // 基础价格
Object.entries(selectedVariants).forEach(([type, value]) => {
  const variant = product.variants?.find(v => v.type === type && v.value === value);
  if (variant && variant.priceModifier) {
    finalPrice += variant.priceModifier; // 累加规格调整
  }
});
```

## 注意事项
1. 价格计算只在添加到购物车时进行，购物车中存储的是最终价格
2. 如果后续需要修改规格，需要重新从商品详情页添加
3. 购物车中的价格是固定的，不会因为商品规格或价格变化而自动更新

---

**测试完成后可删除此文件** 