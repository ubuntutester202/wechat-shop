import{u as S,j as e,d as R,r as l,S as H}from"./index-DWm9dxUp.js";const $={pending:{label:"待付款",color:"text-orange-600 bg-orange-50"},paid:{label:"待发货",color:"text-blue-600 bg-blue-50"},shipped:{label:"待收货",color:"text-green-600 bg-green-50"},delivered:{label:"已完成",color:"text-gray-600 bg-gray-50"},cancelled:{label:"已取消",color:"text-red-600 bg-red-50"}},B=({order:s,onClick:u})=>{const N=S(),g=()=>{u?u(s):N(`/orders/${s.id}`)},i=a=>new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),d=a=>`¥${a.toFixed(2)}`,r=s.items[0],p=s.items.length>1,o=$[s.status];return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 mb-4 cursor-pointer hover:shadow-md transition-shadow",onClick:g,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"订单号:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.orderNumber})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${o.color}`,children:o.label})]}),r&&e.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[e.jsx("img",{src:r.image,alt:r.name,className:"w-16 h-16 rounded-lg object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate hover:text-blue-600 transition-colors",children:r.name}),r.selectedVariants&&Object.keys(r.selectedVariants).length>0&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:Object.entries(r.selectedVariants).map(([a,c])=>e.jsxs("span",{className:"mr-2",children:[a,": ",c]},a))}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["x",r.quantity]}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:d(r.price)})]})]})]}),p&&e.jsxs("div",{className:"text-xs text-gray-500 mb-3 pl-19",children:["还有 ",s.items.length-1," 件其他商品"]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500",children:i(s.createdAt)}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-xs text-gray-600",children:["共",s.items.reduce((a,c)=>a+c.quantity,0),"件商品"]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"实付款: "}),e.jsx("span",{className:"text-sm font-semibold text-red-600",children:d(s.payment.amount)})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-3",children:[(s.status==="pending"||s.status==="paid")&&e.jsx("button",{className:"text-xs px-3 py-1 border border-gray-300 rounded text-gray-600 hover:bg-gray-50",onClick:a=>{a.stopPropagation(),console.log("取消订单:",s.id)},children:"取消订单"}),s.status==="shipped"&&e.jsx("button",{className:"text-xs px-3 py-1 border border-gray-300 rounded text-gray-600 hover:bg-gray-50",onClick:a=>{a.stopPropagation(),console.log("查看物流:",s.shipping.trackingNumber)},children:"查看物流"}),s.status==="delivered"&&e.jsx("button",{className:"text-xs px-3 py-1 border border-gray-300 rounded text-gray-600 hover:bg-gray-50",onClick:a=>{a.stopPropagation(),console.log("评价订单:",s.id)},children:"评价"}),e.jsx("button",{className:"text-xs px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:a=>{a.stopPropagation(),g()},children:"查看详情"})]})]})},z=[{value:"",label:"全部"},{value:"pending",label:"待付款"},{value:"paid",label:"待发货"},{value:"shipped",label:"待收货"},{value:"delivered",label:"已完成"},{value:"cancelled",label:"已取消"}],A=()=>{const s=S(),u=R(),g=new URLSearchParams(u.search).get("status")||"",[i,d]=l.useState([]),[r,p]=l.useState(!1),[o,a]=l.useState(!0),[c,j]=l.useState(1),[m,L]=l.useState(g),[b,w]=l.useState(null),P=()=>{s("/profile")},h=l.useCallback(async(t,n="",y=!1)=>{if(!r){p(!0),w(null);try{const x=new URLSearchParams({page:t.toString(),limit:"10"});n&&x.append("status",n);const C=await fetch(`/api/orders?${x}`);if(!C.ok)throw new Error("获取订单列表失败");const f=await C.json();d(O=>y?f.orders:[...O,...f.orders]),a(t<f.pagination.totalPages),j(t)}catch(x){w(x instanceof Error?x.message:"未知错误"),console.error("获取订单列表失败:",x)}finally{p(!1)}}},[r]),E=t=>{L(t),d([]),j(1),a(!0),h(1,t,!0);const n=new URLSearchParams;t&&n.set("status",t),s(`/orders?${n.toString()}`,{replace:!0})},v=l.useCallback(()=>{if(r||!o)return;const t=window.pageYOffset||document.documentElement.scrollTop,n=window.innerHeight,y=document.documentElement.scrollHeight;t+n>=y-100&&h(c+1,m)},[r,o,c,m,h]);l.useEffect(()=>{h(1,m,!0)},[]),l.useEffect(()=>(window.addEventListener("scroll",v),()=>window.removeEventListener("scroll",v)),[v]);const M=t=>{s(`/orders/${t.id}`)},k=()=>{d([]),j(1),a(!0),h(1,m,!0)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(H,{}),e.jsxs("div",{className:"bg-white shadow-sm pt-12",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:P,className:"mr-3 p-2 -ml-2 text-gray-600 hover:text-gray-900",title:"返回上一页","aria-label":"返回上一页",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"我的订单"})]}),e.jsx("button",{onClick:k,className:"p-2 text-gray-600 hover:text-gray-900",disabled:r,title:"刷新订单列表","aria-label":"刷新订单列表",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsx("div",{className:"flex space-x-2 overflow-x-auto",children:z.map(t=>e.jsx("button",{onClick:()=>E(t.value),className:`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap flex-shrink-0 transition-colors ${m===t.value?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:t.label},t.value))})})]}),e.jsxs("div",{className:"px-4 py-4",children:[b&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 text-red-400 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-red-700",children:b})]}),e.jsx("button",{onClick:k,className:"mt-2 text-sm text-red-600 hover:text-red-800 underline",children:"重试"})]}),!r&&i.length===0&&!b&&e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"mx-auto w-24 h-24 mb-4 text-gray-300",children:e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z",clipRule:"evenodd"})})}),e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"暂无订单"}),e.jsx("p",{className:"text-gray-400 text-sm mb-6",children:"快去挑选心仪的商品吧"}),e.jsx("button",{onClick:()=>s("/shop"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"去购物"})]}),i.map(t=>e.jsx(B,{order:t,onClick:M},t.id)),r&&i.length>0&&e.jsx("div",{className:"text-center py-4",children:e.jsxs("div",{className:"inline-flex items-center space-x-2 text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{children:"加载中..."})]})}),r&&i.length===0&&!b&&e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((t,n)=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded-full w-16"})]}),e.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-100",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})]})]},n))}),!r&&!o&&i.length>0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"没有更多订单了"})})]})]})};export{A as default};
//# sourceMappingURL=OrderListPage-HSCuEYuS.js.map
