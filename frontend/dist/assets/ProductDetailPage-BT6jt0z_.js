import{r as d,j as e,b as A,u as E,c as T,S as F}from"./index-DWm9dxUp.js";import{g as z,c as O}from"./products-JVGU342a.js";const W=({product:a,isOpen:b,onClose:p,onConfirm:s,confirmText:N,initialVariants:v={},initialQuantity:B=1})=>{const[h,w]=d.useState({}),[o,k]=d.useState(1),[g,S]=d.useState(a.price);d.useEffect(()=>{if(b){let r={};a.variants&&Array.from(new Set(a.variants.map(i=>i.type))).forEach(i=>{var l;const x=(l=a.variants)==null?void 0:l.find(m=>m.type===i);x&&(r[i]=x.value)}),w(r),k(1)}},[b]),d.useEffect(()=>{let r=a.price;a.variants&&Object.entries(h).forEach(([c,i])=>{var l;const x=(l=a.variants)==null?void 0:l.find(m=>m.type===c&&m.value===i);x&&x.priceModifier&&(r+=x.priceModifier)}),S(r)},[h,a]);const C=()=>{if(!a.variants)return a.stock||0;const r=Object.entries(h).map(([i,x])=>{var l;return(l=a.variants)==null?void 0:l.find(m=>m.type===i&&m.value===x)}).filter(Boolean);if(r.length===0)return a.stock||0;const c=Math.min(...r.map(i=>(i==null?void 0:i.stock)||a.stock||0));return Math.min(c,a.stock||0)},M=(r,c)=>{w(i=>({...i,[r]:c}))},L=r=>{const c=C();r>=1&&r<=c&&k(r)},y=()=>{if(a.variants){const c=Array.from(new Set(a.variants.map(i=>i.type))).filter(i=>!h[i]);if(c.length>0){alert(`请选择${c.join("、")}`);return}}s(h,o,g),p()},I=(r,c)=>{const i=c.filter(l=>l.type===r),x=r==="color"?"颜色":r==="size"?"尺寸":"选项";return e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:x}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(l=>{const m=h[r]===l.value,j=(l.stock||0)<=0;return e.jsxs("button",{onClick:()=>!j&&M(r,l.value),disabled:j,className:`px-4 py-2 rounded-md border text-sm font-medium transition-colors ${j?"border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed":m?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 bg-white text-gray-700 hover:border-gray-400"}`,children:[l.value,j&&e.jsx("span",{className:"ml-1 text-xs",children:"(缺货)"}),l.priceModifier&&l.priceModifier!==0&&e.jsxs("span",{className:"ml-1 text-xs",children:[l.priceModifier>0?"+":"","¥",l.priceModifier.toFixed(2)]})]},l.id)})})]},r)};if(!b)return null;const f=C();return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:p}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"选择规格"}),e.jsx("button",{onClick:p,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100",title:"关闭","aria-label":"关闭规格选择弹框",children:e.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"overflow-y-auto",style:{maxHeight:"calc(90vh - 140px)"},children:[e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("img",{src:a.image,alt:a.name,className:"w-20 h-20 rounded-md object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xl font-bold text-red-600",children:["¥",g.toFixed(2)]}),g!==a.price&&e.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["¥",a.price.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["库存：",f,"件"]})]})]})}),e.jsxs("div",{className:"p-4",children:[a.variants&&a.variants.length>0&&e.jsx("div",{className:"mb-6",children:Array.from(new Set(a.variants.map(r=>r.type))).map(r=>I(r,a.variants))}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"数量"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>L(o-1),disabled:o<=1,className:"w-10 h-10 rounded-full border border-gray-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",title:"减少数量","aria-label":"减少数量",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20 12H4"})})}),e.jsx("span",{className:"text-lg font-medium w-12 text-center",children:o}),e.jsx("button",{onClick:()=>L(o+1),disabled:o>=f,className:"w-10 h-10 rounded-full border border-gray-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",title:"增加数量","aria-label":"增加数量",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-2",children:["总价：¥",(g*o).toFixed(2)]})]})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsx("button",{onClick:y,disabled:f<=0,className:`w-full py-3 px-4 rounded-lg font-medium transition-colors ${f<=0?"bg-gray-300 text-gray-500 cursor-not-allowed":N==="立即购买"?"bg-red-500 text-white hover:bg-red-600":"bg-yellow-500 text-white hover:bg-yellow-600"}`,children:f<=0?"暂无库存":N})})]})]})},D=()=>{var V;const{id:a}=A(),b=E(),{addItem:p}=T(),[s,N]=d.useState(null),[v,B]=d.useState([]),[h,w]=d.useState(0),[o,k]=d.useState(!1),[g,S]=d.useState("details"),[C,M]=d.useState(!0),[L,y]=d.useState(!1),[I,f]=d.useState("cart");d.useEffect(()=>{a&&(M(!0),setTimeout(()=>{const t=z(a),n=O(a);t&&(N(t),B(n)),M(!1)},300))},[a]);const r=()=>{b(-1)},c=t=>{w(t)},i=()=>{k(!o)},x=()=>{s&&(f("cart"),y(!0))},l=()=>{s&&(f("buy"),y(!0))},m=(t,n,u)=>{s&&(p({productId:s.id,name:s.name,price:u,image:s.image,quantity:n,selectedVariants:t,stock:s.stock||0}),alert(I==="cart"?"已添加到购物车":"跳转到结算页面"))},j=t=>{const n=[];for(let u=1;u<=5;u++)n.push(e.jsx("span",{className:`text-lg ${u<=t?"text-yellow-400":"text-gray-300"}`,children:"⭐"},u));return n},$=t=>e.jsxs("div",{className:"border-b border-gray-200 pb-4 mb-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-300 rounded-full mr-3",children:t.userAvatar&&e.jsx("img",{src:t.userAvatar,alt:t.userName,className:"w-full h-full rounded-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:t.userName}),t.verified&&e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"已购买"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("div",{className:"flex",children:j(t.rating)}),e.jsx("span",{children:t.createdAt.toLocaleDateString()})]})]})]}),e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:t.title}),e.jsx("p",{className:"text-gray-600 mb-2",children:t.content}),t.variant&&e.jsxs("span",{className:"text-sm text-gray-500",children:["已购买：",t.variant]}),t.images&&t.images.length>0&&e.jsx("div",{className:"flex gap-2 mt-2",children:t.images.map((n,u)=>e.jsx("img",{src:n,alt:`评价图片${u+1}`,className:"w-20 h-20 rounded-md object-cover"},u))})]},t.id);if(C)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(F,{}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})]});if(!s)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(F,{}),e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"商品不存在"}),e.jsx("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"返回"})]})]});const P=s.images||[s.image];return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(F,{}),e.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsx("button",{onClick:r,className:"flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100",title:"返回上一页",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-lg font-medium text-gray-900",children:"商品详情"}),e.jsx("button",{onClick:()=>{},className:"flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-100",title:"分享商品",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})})})]})}),e.jsxs("div",{className:"pb-20",children:[e.jsxs("div",{className:"bg-white mb-2",children:[e.jsxs("div",{className:"aspect-square relative",children:[e.jsx("img",{src:P[h],alt:s.name,className:"w-full h-full object-cover"}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"absolute top-4 left-4",children:s.tags.map((t,n)=>e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium text-white mr-2 ${t==="New"?"bg-blue-500":t==="Sale"?"bg-red-500":t==="Hot"?"bg-orange-500":"bg-gray-500"}`,children:t},n))})]}),P.length>1&&e.jsx("div",{className:"flex justify-center py-3 gap-2",children:P.map((t,n)=>e.jsx("button",{onClick:()=>c(n),className:`w-3 h-3 rounded-full transition-colors ${n===h?"bg-blue-600":"bg-gray-300"}`,title:`查看第${n+1}张图片`},n))})]}),e.jsxs("div",{className:"bg-white px-4 py-6 mb-2",children:[e.jsx("h1",{className:"text-xl font-medium text-gray-900 mb-3",children:s.name}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-red-600",children:["¥",s.price.toFixed(2)]}),s.originalPrice&&e.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["¥",s.originalPrice.toFixed(2)]})]}),s.discount&&e.jsxs("span",{className:"bg-red-100 text-red-800 text-sm px-2 py-1 rounded",children:[s.discount,"% OFF"]})]}),e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[j(s.rating||0),e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:[(V=s.rating)==null?void 0:V.toFixed(1)," (",s.reviews,"条评价)"]})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["库存: ",s.stock||0,"件"]}),e.jsxs("span",{children:["品牌: ",s.brand||"暂无"]})]})]}),e.jsxs("div",{className:"bg-white",children:[e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("button",{onClick:()=>S("details"),className:`flex-1 py-4 px-4 text-center font-medium ${g==="details"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"}`,children:"商品详情"}),e.jsxs("button",{onClick:()=>S("reviews"),className:`flex-1 py-4 px-4 text-center font-medium ${g==="reviews"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"}`,children:["用户评价 (",v.length,")"]})]}),e.jsxs("div",{className:"px-4 py-6",children:[g==="details"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"商品描述"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:s.description||"暂无商品描述"})]}),s.specifications&&s.specifications.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"商品规格"}),e.jsx("div",{className:"space-y-2",children:s.specifications.map((t,n)=>e.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:t.name}),e.jsx("span",{className:"text-gray-900",children:t.value})]},n))})]}),(s.shippingInfo||s.returnPolicy||s.warranty)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"服务保障"}),e.jsxs("div",{className:"space-y-2",children:[s.shippingInfo&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-green-600",children:"🚚"}),e.jsx("span",{className:"text-gray-600",children:s.shippingInfo})]}),s.returnPolicy&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"🔄"}),e.jsx("span",{className:"text-gray-600",children:s.returnPolicy})]}),s.warranty&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-yellow-600",children:"🛡️"}),e.jsx("span",{className:"text-gray-600",children:s.warranty})]})]})]})]}),g==="reviews"&&e.jsx("div",{children:v.length>0?e.jsx("div",{children:v.map($)}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"暂无用户评价"})})]})]})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-3 flex items-center gap-3",children:[e.jsx("button",{onClick:i,className:`flex flex-col items-center justify-center w-12 h-12 rounded-lg ${o?"text-red-500":"text-gray-400"}`,title:o?"取消收藏":"收藏商品",children:e.jsx("svg",{className:"w-6 h-6",fill:o?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})}),e.jsx("button",{onClick:x,className:"flex-1 bg-yellow-500 text-white font-medium py-3 px-4 rounded-lg hover:bg-yellow-600 transition-colors",children:"加入购物车"}),e.jsx("button",{onClick:l,className:"flex-1 bg-red-500 text-white font-medium py-3 px-4 rounded-lg hover:bg-red-600 transition-colors",children:"立即购买"})]}),s&&e.jsx(W,{product:s,isOpen:L,onClose:()=>y(!1),onConfirm:m,confirmText:I==="cart"?"加入购物车":"立即购买"})]})};export{D as default};
//# sourceMappingURL=ProductDetailPage-BT6jt0z_.js.map
